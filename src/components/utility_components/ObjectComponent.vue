<template>
<<<<<<< HEAD
  <div v-if="showInputField">
    <h5 :id="anchorIdFormat(schema)" :class="[styleClass]">{{ schema.title }}</h5>
=======
  <div class="col-lg-12 scroll-watch" v-if="showInputField">
    <h5 :id="anchorIdFormat(schema)">{{ schema.title }}</h5>
>>>>>>> 4ba80cde14f0da1de31368188e59fe21f1d012af
    <div class="obj_box row">
      <component 
        v-for="(field, key) in schema.properties" 
        :key="key" 
        :is="getComponentName(field)" 
        :schema="field" 
        :path="path.concat(key)" 
        :currentKey="key" 
        v-model="value[currentFieldName]">
      </component>
    </div>
  </div>
</template>

<script>
import TextInput from '../input_components/TextInput'
import bsRadioInput from '../input_components/bsRadioInput'
import Checkbox from '../input_components/Checkbox'
import CheckList from '../input_components/CheckList'
import CheckListWithOther from '../input_components/CheckListWithOther'
import NumberInput from '../input_components/NumberInput'
import SelectDate from '../input_components/SelectDate'
import SelectList from '../input_components/SelectList'
import bsLabTable from "../input_components/bsLabTable"
import OrgChart from "../input_components/OrgChart"
import FamilyTree from "../input_components/FamilyTree"
import FuncAssess from "../input_components/FuncAssess"
import Proto from '../input_components/Proto';

export default {
  name: 'ObjectComponent',
  mixins: [Proto],
  components: {
    TextInput,
    bsRadioInput,
    Checkbox,
    CheckList,
    NumberInput,
    SelectList,
    SelectDate,
    CheckListWithOther,
    bsLabTable,
    FamilyTree,
    FuncAssess,
    OrgChart
  },
  props: {
    schema: {
      type: Object,
      default() {
        return {}
      }
    },
    value: {
      type: Object,
      default() {
        return {}
      }
    },
    path: {
      type: Array,
      default() {
        return []
      }
    },
    currentKey: {
      type: String,
      default() {
        return ''
      }
    },
    sectsKeys: {
			type: Array,
			default() {
				return []
			}
		}
  },
  data() {
    return {
      currentFieldName: this.currentKey,
      sectionKeys: null
    }
  },
  created() {
    if (!(this.currentFieldName in this.value)) {
      // this.value[this.currentFieldName] = {}
      // this.$emit('input', this.value)
      this.$set(this.value, this.currentFieldName, {})
      //this.value["keyOnCreate"] = {};
    }

    this.sectionKeys = this.sectsKeys
  },
  methods: {
    getComponentName(field) {
      let $com = 'TextInput'
      let $type_field = {
        object: 'object',
        string: 'text',
        number: 'number',
        integer: 'number',
        array: 'checklist',
        boolean: 'radio'
      }
      let $field_com = {
        text: 'TextInput',
        checklistwithother: 'CheckListWithOther',
        radio: 'bsRadioInput',
        checkbox: 'Checkbox',
        checklist: 'CheckList',
        selectList: 'SelectList',
        object: 'ObjectComponent',
        number: 'NumberInput',
        date: 'SelectDate',
        labtable: "bsLabTable",
        familytree: "FamilyTree",
        funcassess:"FuncAssess"
      }
      if (!field.attrs) {
        field.attrs = {}
      }
      if (!field.attrs.fieldType) {
        if (field.type) {
          field.attrs.fieldType = $type_field[field.type]
        } else {
          field.attrs.fieldType = 'text'
        }
      }
      return $field_com[field.attrs.fieldType] || 'TextInput'
      /*
      if (!(field.attrs && field.attrs.fieldType)) {
				if (field.type === 'string') {
					return "TextInput"
				}
				else if (field.type === 'number' || field.type === 'integer') {
					return "NumberInput"
				}			
				else if (field.type === 'object') {
					return "ObjectComponent"
				}		
				else if (field.type === 'array') {
					return "CheckList"
				}	
			}
      
      switch (field.attrs.fieldType) {
        case 'text':
          return 'TextInput'
        case 'radio':
          return 'RadioInput'
        case 'checkbox':
          return 'Checkbox'
        case 'checklist':
          return 'CheckList'
        case 'selectList':
          return 'SelectList'
        case 'object':
          return 'ObjectComponent'
        case 'number':
          return 'NumberInput'
        case 'date':
          return 'SelectDate'
        case 'checklistwithother':
          return 'CheckListWithOther'
      }
      */
    },
    clearInput() {
      // this.value[this.schema.attrs.fieldName] = null
      if (this.currentFieldName in this.value) {
        this.$set(this.value, this.currentFieldName, {})
      }
    }
  },
  computed: {
    
    showInputField() {
      let schemaAttrs = this.schema.attrs
      //dependsOn name is Array?
      if (schemaAttrs) {
        if (schemaAttrs.dependsOn) {
          if (schemaAttrs.dependsOn.values && schemaAttrs.dependsOn.name) {
            if (Array.isArray(this.value[schemaAttrs.dependsOn.name])) {
              for (let i = 0; i < schemaAttrs.dependsOn.values.length; i++) {
                if (
                  this.value[schemaAttrs.dependsOn.name].indexOf(
                    schemaAttrs.dependsOn.values[i]
                  ) !== -1
                ) {
                  return true
                } else {
                  this.clearInput()
                  return false
                }
              }
            } else {
              if (
                schemaAttrs.dependsOn.values.indexOf(
                  this.value[schemaAttrs.dependsOn.name]
                ) !== -1
              ) {
                return true
              } else {
                this.clearInput()
                return false
              }
            }
          }
          return true
        }
        return true
      }
      return true
    }
  }
}
</script>

<style>
.obj_box {
  padding: 1rem;
}
.display-inline {
  display: inline-block;
}
.padding-left {
  padding-left: 3px;
}
</style>


